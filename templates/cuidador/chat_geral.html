{% extends "base_simples.html" %}

{% block conteudo %}
<section class="py-5 bg-light" id="chat_geral">
    <div class="container">
        <h2 class="text-center mb-4">Chat Geral</h2>

        <!-- Exibição das mensagens -->
        {% if mensagens %}
            <ul class="list-group mb-4">
                {% for m in mensagens %}
                    <li class="list-group-item d-flex justify-content-between align-items-center">
                        <div>
                            <strong>{{ m.autor }}:</strong> {{ m.mensagem }}
                        </div>
                        <button type="button" class="btn btn-sm btn-outline-primary responder-btn" data-autor="{{ m.autor }}">
                            Responder
                        </button>
                    </li>
                {% endfor %}
            </ul>
        {% else %}
            <ul class="list-group mb-4">
                {% set mensagens_fake = [
                    {'autor': 'Ana', 'mensagem': 'Você atende em todos os horários?'},
                    {'autor': 'Bruno', 'mensagem': 'Quais serviços você oferece?'},
                    {'autor': 'Carla', 'mensagem': 'Tem disponibilidade para finais de semana?'},
                    {'autor': 'Diego', 'mensagem': 'Faz atendimento domiciliar?'}
                ] %}
                {% for m in mensagens_fake %}
                    <li class="list-group-item d-flex justify-content-between align-items-center">
                        <div>
                            <strong>{{ m.autor }}:</strong> {{ m.mensagem }}
                        </div>
                        <button type="button" class="btn btn-sm btn-outline-primary responder-btn" data-autor="{{ m.autor }}">
                            Responder
                        </button>
                    </li>
                {% endfor %}
            </ul>
        {% endif %}

        <!-- Mensagem de feedback -->
        <div id="msg-sucesso" class="alert alert-success text-center" style="display:none;"></div>

        <!-- Área para responder -->
        <form id="resposta-form">
            <div class="mb-3">
                <label for="resposta" class="form-label">Responder mensagem</label>
                <textarea class="form-control" id="resposta" name="resposta" rows="3" placeholder="Clique em responder para começar..."></textarea>
            </div>
            <button type="submit" class="btn btn-primary">Enviar resposta</button>
        </form>

        <div class="text-center mt-3">
            <a href="/cuidador/home_cuidador" class="btn btn-success">Voltar para Home</a>
        </div>
    </div>
</section>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const buttons = document.querySelectorAll('.responder-btn');
        const textarea = document.getElementById('resposta');
        const form = document.getElementById('resposta-form');
        const msgSucesso = document.getElementById('msg-sucesso');

        buttons.forEach(button => {
            button.addEventListener('click', () => {
                const autor = button.getAttribute('data-autor');
                textarea.value = `@${autor} `;
                textarea.focus();
                // Esconde a mensagem de sucesso ao abrir novo reply
                msgSucesso.style.display = 'none';
                msgSucesso.textContent = '';
            });
        });

        form.addEventListener('submit', function(event) {
            event.preventDefault(); // Previne envio real

            const resposta = textarea.value.trim();
            if(resposta === '') {
                alert('Por favor, digite uma resposta antes de enviar.');
                return;
            }

            // Mostrar mensagem de sucesso
            msgSucesso.textContent = 'Resposta enviada com sucesso!';
            msgSucesso.style.display = 'block';

            // Limpar textarea
            textarea.value = '';
        });
    });
</script>
{% endblock %}
