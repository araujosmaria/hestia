{% extends "base_simples.html" %}
{% from 'macros/alerts.html' import success_message %}

{% set erros = erros if erros is defined else {} %}
{% set dados = dados if dados is defined else {} %}

{% block conteudo %}
<div class="container cadastro-container">
    <div class="header-cadastro">
        <h1>Cadastro Contratante</h1>
        <p class="subtitle">Insira as informações para criar a sua conta</p>
    </div>

    {{ success_message(mensagem) }}


    <form id="formCliente" class="cadastro-form" method="post" enctype="multipart/form-data">
        <div class="form-section">
            <h3 class="section-title">
                <i class="bi bi-person-fill"></i>
                Dados Pessoais
            </h3>

            <div class="row">
                <div class="col-md-8">
                    <label for="nome" class="form-label">Nome Completo</label>
                    <input type="text"
                           class="form-control {% if 'nome' in erros %}is-invalid{% endif %}"
                           id="nome"
                           name="nome"
                           value="{{ dados.get('nome', '') }}"
                           required>
                    {% if 'nome' in erros %}
                    <div class="invalid-feedback">{{ erros['nome'] }}</div>
                    {% endif %}
                </div>
                <div class="col-md-4">
                    <label for="dataNascimento" class="form-label">Data de Nascimento</label>
                    <input type="date"
                           class="form-control {% if 'dataNascimento' in erros %}is-invalid{% endif %}"
                           id="dataNascimento"
                           name="dataNascimento"
                           value="{{ dados.get('dataNascimento', '') }}"
                           required>
                    {% if 'dataNascimento' in erros %}
                    <div class="invalid-feedback">{{ erros['dataNascimento'] }}</div>
                    {% endif %}
                </div>
            </div>

            <div class="row">
                <div class="col-md-6">
                    <label for="email" class="form-label">Email</label>
                    <input type="email"
                           class="form-control {% if 'email' in erros %}is-invalid{% endif %}"
                           id="email"
                           name="email"
                           value="{{ dados.get('email', '') }}"
                           required>
                    {% if 'email' in erros %}
                    <div class="invalid-feedback">{{ erros['email'] }}</div>
                    {% endif %}
                </div>
                <div class="col-md-3">
                    <label for="telefone" class="form-label">Telefone/WhatsApp</label>
                    <input type="tel"
                           class="form-control {% if 'telefone' in erros %}is-invalid{% endif %}"
                           id="telefone"
                           name="telefone"
                           value="{{ dados.get('telefone', '') }}"
                           required>
                    {% if 'telefone' in erros %}
                    <div class="invalid-feedback">{{ erros['telefone'] }}</div>
                    {% endif %}
                </div>
                <div class="col-md-3">
                    <label for="cpf" class="form-label">CPF</label>
                    <input type="text"
                           class="form-control {% if 'cpf' in erros %}is-invalid{% endif %}"
                           id="cpf"
                           name="cpf"
                           value="{{ dados.get('cpf', '') }}"
                           required>
                    {% if 'cpf' in erros %}
                    <div class="invalid-feedback">{{ erros['cpf'] }}</div>
                    {% endif %}
                </div>
            </div>

            <div class="row">
                <div class="col-md-6">
                    <label for="relacao" class="form-label">Relação com a pessoa a ser cuidada</label>
                    <select class="form-select {% if 'parentesco_paciente' in erros %}is-invalid{% endif %}"
                            id="relacao"
                            name="parentesco_paciente"
                            required>
                        <option value="">Selecione...</option>
                        <option value="filho" {% if dados.get('parentesco_paciente') == 'filho' %}selected{% endif %}>Filho(a)</option>
                        <option value="conjuge" {% if dados.get('parentesco_paciente') == 'conjuge' %}selected{% endif %}>Cônjuge</option>
                        <option value="neto" {% if dados.get('parentesco_paciente') == 'neto' %}selected{% endif %}>Neto(a)</option>
                        <option value="irmao" {% if dados.get('parentesco_paciente') == 'irmao' %}selected{% endif %}>Irmão(ã)</option>
                        <option value="sobrinho" {% if dados.get('parentesco_paciente') == 'sobrinho' %}selected{% endif %}>Sobrinho(a)</option>
                        <option value="responsavel" {% if dados.get('parentesco_paciente') == 'responsavel' %}selected{% endif %}>Responsável Legal</option>
                        <option value="proprio" {% if dados.get('parentesco_paciente') == 'proprio' %}selected{% endif %}>Eu mesmo(a)</option>
                        <option value="outro" {% if dados.get('parentesco_paciente') == 'outro' %}selected{% endif %}>Outro</option>
                    </select>
                    {% if 'parentesco_paciente' in erros %}
                    <div class="invalid-feedback">{{ erros['parentesco_paciente'] }}</div>
                    {% endif %}
                </div>
            </div>
        </div>

        <div class="form-section">
            <h3 class="section-title">
                <i class="bi bi-camera-fill"></i>
                Foto de Perfil (Opcional)
            </h3>
            <div class="foto-upload-area">
                <div class="upload-box">
                    <span>Clique para adicionar uma foto</span>
                    <input type="file" id="fotoPerfil" accept="image/*" name="fotoPerfil">
                </div>

                <div id="preview-foto-container" class="preview-foto-container d-none">
                    <img id="preview-foto" src="" class="rounded-circle">
                </div>
            </div>
        </div>

        <div class="form-section">
            <h3 class="section-title">
                <i class="bi bi-geo-alt-fill"></i>
                Localização
            </h3>

            <div class="row">
                <div class="col-md-3">
                    <label for="cep" class="form-label">CEP</label>
                    <input type="text"
                           class="form-control {% if 'cep' in erros %}is-invalid{% endif %}"
                           id="cep"
                           name="cep"
                           value="{{ dados.get('cep', '') }}"
                           required>
                    {% if 'cep' in erros %}
                    <div class="invalid-feedback">{{ erros['cep'] }}</div>
                    {% endif %}
                </div>
                <div class="col-md-6">
                    <label for="endereco" class="form-label">Endereço</label>
                    <input type="text"
                           class="form-control {% if 'logradouro' in erros %}is-invalid{% endif %}"
                           id="endereco"
                           name="logradouro"
                           value="{{ dados.get('logradouro', '') }}"
                           required>
                    {% if 'logradouro' in erros %}
                    <div class="invalid-feedback">{{ erros['logradouro'] }}</div>
                    {% endif %}
                </div>
                <div class="col-md-3">
                    <label for="numero" class="form-label">Número</label>
                    <input type="text"
                           class="form-control {% if 'numero' in erros %}is-invalid{% endif %}"
                           id="numero"
                           name="numero"
                           value="{{ dados.get('numero', '') }}">
                    {% if 'numero' in erros %}
                    <div class="invalid-feedback">{{ erros['numero'] }}</div>
                    {% endif %}
                </div>
            </div>

            <div class="row">
                <div class="col-md-4">
                    <label for="bairro" class="form-label">Bairro</label>
                    <input type="text"
                           class="form-control {% if 'bairro' in erros %}is-invalid{% endif %}"
                           id="bairro"
                           name="bairro"
                           value="{{ dados.get('bairro', '') }}"
                           required>
                    {% if 'bairro' in erros %}
                    <div class="invalid-feedback">{{ erros['bairro'] }}</div>
                    {% endif %}
                </div>
                <div class="col-md-4">
                    <label for="cidade" class="form-label">Cidade</label>
                    <input type="text"
                           class="form-control {% if 'cidade' in erros %}is-invalid{% endif %}"
                           id="cidade"
                           name="cidade"
                           value="{{ dados.get('cidade', '') }}"
                           required>
                    {% if 'cidade' in erros %}
                    <div class="invalid-feedback">{{ erros['cidade'] }}</div>
                    {% endif %}
                </div>
                <div class="col-md-4">
                    <label for="estado" class="form-label">Estado</label>
                    <input type="text"
                           class="form-control {% if 'estado' in erros %}is-invalid{% endif %}"
                           id="estado"
                           name="estado"
                           value="{{ dados.get('estado', '') }}"
                           required>
                    {% if 'estado' in erros %}
                    <div class="invalid-feedback">{{ erros['estado'] }}</div>
                    {% endif %}
                </div>
            </div>
        </div>

        <div class="form-section">
            <h3 class="section-title">
                <i class="bi bi-lock-fill"></i>
                Segurança da Conta
            </h3>

            <div class="row">
                <div class="col-md-6">
                    <label for="senha" class="form-label">Senha</label>
                    <input type="password"
                           class="form-control {% if 'senha' in erros %}is-invalid{% endif %}"
                           id="senha"
                           name="senha"
                           required>
                    <small class="form-text">Mínimo 8 caracteres</small>
                    {% if 'senha' in erros %}
                    <div class="invalid-feedback">{{ erros['senha'] }}</div>
                    {% endif %}
                </div>
                <div class="col-md-6">
                    <label for="confirmarSenha" class="form-label">Confirmar Senha</label>
                    <input type="password"
                           class="form-control {% if 'confirmarSenha' in erros %}is-invalid{% endif %}"
                           id="confirmarSenha"
                           name="confirmarSenha"
                           required>
                    {% if 'confirmarSenha' in erros %}
                    <div class="invalid-feedback">{{ erros['confirmarSenha'] }}</div>
                    {% endif %}
                </div>
            </div>
        </div>

        <div class="form-section">
            <div class="termos-area">
                <div class="form-check">
                    <input type="checkbox" class="form-check-input" id="termos" name="termos" required>
                    <label class="form-check-label" for="termos">
                        Li e aceito os <a href="#" class="link-termos">Termos de Uso</a> e a <a href="#"
                            class="link-termos">Política de Privacidade.</a>
                    </label>
                </div>
            </div>
        </div>

        <div class="form-actions">
            <button type="submit" class="btn-criar-conta">
                <i class="bi bi-check-circle"></i>
                Criar Minha Conta
            </button>
            <p class="login-link">
                Já tem conta? <a href="/login">Faça login aqui</a>
            </p>
        </div>
    </form>
</div>
{% endblock %}

{% block scripts %}
<script src="/static/js/cadastro-form.js"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.2/font/bootstrap-icons.css">
{% endblock %}